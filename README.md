# KoGPT2 + VIT (Baseline model)


## Repository Structure
```
# Data resource for training (can be downloaded from https://kli.korean.go.kr/benchmark/taskOrdtm/taskDownload.do?taskOrdtmId=58&clCd=ING_TASK&subMenuId=sub02)
../data
├── nikluge-gips-2023_image  # Please insert the image data for training in this format
└── nikluge-gips-2023_JSONL  # Please insert the JSON files for training in this format

# Code for model training, inference, and scoring 
run
├── infernece.py  
├── train.py
└── scoring.py

# Code for data preprocessing, model definition, and utility functions
src
├── data.py     # torch dataloader
├── module.py   # pytorch-lightning module
└── utils.py    # utility functions

MeCab
└── install_mecab.sh    # mecab installation script

configs 
├── config_train.yaml  # configuration for train
├── config_inference.yaml  # configuration for inference
└── config_scoring.yaml  # configuration for scoring

# poetry.lock and pyproject.toml are automatically generated by poetry and should not be modified manually
# requirements.txt contains all necessary dependencies for running the project
```

## Data
### How to prepare data
```
{"id": "nikluge-gips-2023-train-000000", "input": {"id": "P00001", "image_width": 6000, "image_height": 4000, "ocr_info": [{"words": "2인승", "type": "rect", "bbox": {"x": 486, "y": 1091, "width": 891, "height": 193}}]}, "output": ["2인승이라고 적혀 있는 하늘색 테두리 안내판 옆에는 다양한 색깔의 우산들이 띄워져 있다.", "다양한 색깔의 우산들이 띄워져 있는 곳 옆에는 2인승이라고 쓰인 하늘색 테두리 안내판이 있다,", "다양한 색깔의 우산이 띄워진 곳 옆에 있는 하늘색 테두리 안내판에는 2인승이라고 적혀 있다.", "하늘색 테두리 안내판에는 2인승이라고 적혀 있는데, 그 옆에 띄워져 있는 것은 다양한 색깔의 우산들이다.", "안내판은 하늘색 테두리에 2인승이라고 적혀 있으며, 그 옆에 띄워져 있는 것은 다양한 색의 우산들이다."]}
...
```
* The input data is in JSONL format.

## Installation
Prerequisites
- Ensure you have Python 3.10 or higher installed.
- Poetry is required for managing dependencies.
Execute this if mecab is not installed:

Setting Up the Environment
1. Clone the Repository (if applicable):

```
git clone <repository-url>
cd Korean_IC_Competition
```

2. Install Mecab (if required):
If Mecab is not installed, run the following script:
```
MeCab/install_mecab.sh
```

3. Update apt-get and install poetry and git
```
apt-get update
apt-get install -y git
apt-get install -y curl
curl -sSL https://install.python-poetry.org | python3 -
apt-get install sudo
```

5. Apply configuration changes to bashrc (if applicable):
```
# Open the .bashrc file
vim ~/.bashrc

# 1. Go to the bottom of the page. 
# 2. Press i to enter insert mode. (Insert the lines below)
# 3. Press ESC to exit insert mode, then press :wq to save and exit.
export PATH="$HOME/.local/bin:$PATH"
export PYTHONPATH="${PYTHONPATH}:${PWD}"
export VIRTUAL_ENV_DISABLE_PROMPT=0
export PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:128

# Apply the changes
source ~/.bashrc

# Verify versions for correct installation
poetry --version           # Poetry (version 1.8.3)
git --version              # git version 2.25.1
```


5. Install Dependencies with Poetry 
Poetry will manage all the dependencies and create a virtual environment:
```
poetry install
```

6. Activate the Virtual Environment:
To activate the virtual environment created by Poetry, use:
```
poetry shell
```

## How to Run (Training, Inference, Scoring)
* Note: Please change your configurations through modifying config_*.yaml files in configs folder

### Fine-tuning
```
poetry run python run/train.py 
```
- The default models are google/vit-base-patch16-224-in21k and skt/kogpt2-base-v2.
- Training logs and models will be saved in the specified output-dir.

### Inference
```
poetry run python run/inference.py 
```
- The transformers model is loaded for inference.
- During inference, the output data is saved in jsonl format, and the output will be a string instead of a list.

### Scoring
```
poetry run python run/score.py 
```
- Scoring is performed using the inference output.
- By default, ROUGE-1 and BLEU are provided.

### Environment Export
To export the environment, run the following command:
```
poetry export -f requirements.txt --output requirements.txt --without-hashes
```

## License
MIT License

## Credits
This code was developed by the Sionic AI research team. For any inquiries or further information regarding this code, please reach out to Sangwon Baek at baeksw98@sionic.ai.
To learn more about our company and our vision for the future of AI, please visit our website at https://sionic.ai/.